<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <title>Let's Work with Myle Community ðŸš€</title>
  <link rel="icon" type="image/png" href="https://i.ibb.co/27S5hrzd/favicon.png" />

  <!-- âœ… Meta Pixel Base Code -->
  <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1357484016013958');
  </script>
  <noscript>
    <img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=1357484016013958&ev=PageView&noscript=1"/>
  </noscript>

  <!-- âœ… Styles -->
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: #0e0e14;
      overflow: hidden;
      overscroll-behavior: none;
    }
    iframe {
      border: none;
      width: 100%;
      height: 100vh;
      display: block;
      background: #0e0e14;
    }
    #formWrapper {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #0e0e14;
    }
  </style>
</head>

<body>
  <!-- âœ… Form Container -->
  <div id="formWrapper">
    <iframe
      id="zohoFormFrame"
      title="Let's Work with Myle Community ðŸš€"
      sandbox="allow-scripts allow-forms allow-same-origin"
      referrerpolicy="no-referrer-when-downgrade"
    ></iframe>
  </div>

  <!-- âœ… JS Logic -->
  <script>
    const baseURL = "https://forms.mylecommunity.in/gurveer1174gm1/form/LetsWorkwithMyleCommunity/formperma/iIbYvhTGIeBarrSAlYsC4GJzUeaqa8rwMJZ3acAJ4L8";

    // --- Get fbclid from Meta Ads or cookie ---
    const params = new URLSearchParams(window.location.search);
    const fbclid = params.get('fbclid') || (document.cookie.match(/_fbc=fb\.1\.\d+\.(\w+)/) ? RegExp.$1 : null);
    let formURL = baseURL;

    if (fbclid) {
      formURL += (baseURL.includes('?') ? '&' : '?') + 'fbclid=' + fbclid;
      const fbc = `fb.1.${Date.now()}.${fbclid}`;
      document.cookie = `_fbc=${fbc}; path=/; max-age=${60*60*24*90};`;
    }

    // --- Load form ---
    const iframe = document.getElementById('zohoFormFrame');
    iframe.src = formURL;

    // --- Track PageView once ---
    if (!sessionStorage.getItem('myle_pageview_fired')) {
      fbq('track', 'PageView');
      sessionStorage.setItem('myle_pageview_fired', 'true');
    }

    // --- Detect successful submission (universal Zoho detection) ---
    window.addEventListener('message', function(e) {
      try {
        const msg = (typeof e.data === 'string') ? e.data.toLowerCase() : JSON.stringify(e.data).toLowerCase();
        if (msg.includes('successfully submitted') || msg.includes('thank') || msg.includes('submitted')) {
          fbq('track', 'Lead', {
            content_name: 'Zoho Form Submission',
            event_id: 'myle_lead_' + Date.now()
          });
          console.log('âœ… Lead event triggered');
          window.location.href = "https://leads.mylecommunity.in/thankyou.html";
        }
      } catch (err) {
        console.warn('Lead detection error:', err);
      }
    });

    // --- Backup redirect if iframe URL changes ---
    iframe.addEventListener('load', () => {
      try {
        const currentSrc = iframe.contentWindow.location.href;
        if (currentSrc.includes("thankyou")) {
          window.location.href = "https://leads.mylecommunity.in/thankyou.html";
        }
      } catch {}
    });
  </script>
</body>
</html>
