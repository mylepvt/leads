<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Let's Work with Myle Community ðŸš€</title>

  <!-- âœ… Meta Pixel Base Code -->
  <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1357484016013958');
  </script>
  <noscript>
    <img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=1357484016013958&ev=PageView&noscript=1"/>
  </noscript>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: #0e0e14;
      overflow: hidden;
    }
    #formWrapper iframe {
      border: none;
      width: 100%;
      height: 100vh;
      display: block;
      background: #0e0e14 !important;
    }
    body {
      background-color: #0e0e14 !important;
      overflow: hidden !important;
    }
  </style>
</head>
<body>

  <!-- âœ… Zoho Form Embed -->
  <div id="formWrapper" style="position:fixed; top:0; left:0; width:100%; height:100%; overflow:hidden; background:#0e0e14;">
    <iframe
      id="zohoFormFrame"
      title="Let's Work with Myle Community ðŸš€"
      sandbox="allow-scripts allow-forms allow-same-origin"
      referrerpolicy="no-referrer-when-downgrade"
    ></iframe>
  </div>

  <script>
    const baseURL = "https://forms.mylecommunity.in/gurveer1174gm1/form/LetsWorkwithMyleCommunity/formperma/iIbYvhTGIeBarrSAlYsC4GJzUeaqa8rwMJZ3acAJ4L8";

    // --- Get fbclid automatically (from Meta ads or previous visit)
    const params = new URLSearchParams(window.location.search);
    const fbclid = params.get('fbclid') || (document.cookie.match(/_fbc=fb\.1\.\d+\.(\w+)/) ? RegExp.$1 : null);
    let formURL = baseURL;

    if (fbclid) {
      formURL += (baseURL.includes('?') ? '&' : '?') + 'fbclid=' + fbclid;
      const fbc = `fb.1.${Date.now()}.${fbclid}`;
      document.cookie = `_fbc=${fbc}; path=/; max-age=${60*60*24*90};`;
    }

    // --- Load Zoho form dynamically
    const iframe = document.getElementById('zohoFormFrame');
    iframe.src = formURL;

    // --- Track PageView only once
    if (!sessionStorage.getItem('myle_pageview_fired')) {
      fbq('track', 'PageView');
      sessionStorage.setItem('myle_pageview_fired', 'true');
    }

    // --- Detect submission success & send Lead event
    window.addEventListener('message', function(e) {
      if (e.data && e.data.includes('successfully submitted')) {
        fbq('track', 'Lead', {
          content_name: 'Zoho Landing Form',
          event_id: 'myle_lead_' + Date.now()
        });
        console.log('âœ… Lead event sent to Meta');
        window.location.href = "https://leads.mylecommunity.in/thankyou.html";
      }
    });

    // --- Safety fallback: If iframe navigates to thank-you
    iframe.addEventListener('load', () => {
      try {
        const currentSrc = iframe.contentWindow.location.href;
        if (currentSrc.includes("thankyou")) {
          window.location.href = "https://leads.mylecommunity.in/thankyou.html";
        }
      } catch {}
    });
  </script>

</body>
</html>
